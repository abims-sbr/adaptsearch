<tool name="POGs" id="POGs" version="2.0">

	<description>
		Find orthologous groups
	</description>

	<macros>
		<import>macros.xml</import>
	</macros>

	<requirements>
		<expand macro="python_required" />
	</requirements>

  	<command>
	<![CDATA[
        #set $infiles_from_filter_assembly = ""
        #for $input_from_filter_assembly in $inputs_from_filter_assembly
            ln -s '$input_from_filter_assembly' '$input_from_filter_assembly.element_identifier';
            #set $infiles_from_filter_assembly = $infiles_from_filter_assembly + $input_from_filter_assembly.element_identifier + ","
        #end for
        #set $infiles_from_filter_assembly = $infiles_from_filter_assembly[:-1]

        #set $infiles_from_paiwise_prot = ""
        #for $input_from_paiwise_prot in $inputs_from_paiwise_prot
            ln -s '$input_from_paiwise_prot' '$input_from_paiwise_prot.element_identifier';
            #set $infiles_from_paiwise_prot = $infiles_from_paiwise_prot + $input_from_paiwise_prot.element_identifier + ","
        #end for
        #set $infiles_from_paiwise_prot = $infiles_from_paiwise_prot[:-1]

		python $__tool_directory__/scripts/S01_get_locus_ortholog_part1.py $infiles_from_paiwise_prot
		> ${log} &&

		python $__tool_directory__/scripts/S02_get_locus_ortholog_part2.py $infiles_from_filter_assembly
		>> ${log};
	]]>
  	</command>

 	<inputs>
        <param name="inputs_from_filter_assembly" type="data" format="fasta" multiple="true" label="Input files from Filter assemblies" />
        <param name="inputs_from_paiwise_prot" type="data" format="fasta" multiple="true" label="Input files from Pairwise Prot" />
	</inputs>

	<outputs>
		<data format="txt" name="log" label="POGs" />
        <collection name="output" type="list" label="POGs locus orthologs unaligned">
            <discover_datasets pattern="__name_and_ext__" directory="outputs" />
        </collection>
	</outputs>

	<tests>
		<test>
            <param name="inputs_from_filter_assembly" ftype="fasta" value="inputs_from_filter_assembly/PfPfiji_Trinity.fasta,inputs_from_filter_assembly/ApApomp_Trinity.fasta,inputs_from_filter_assembly/AmAmphi_Trinity.fasta,inputs_from_filter_assembly/AcAcaud_Trinity.fasta" />
            <param name="inputs_from_paiwise_prot" ftype="fasta" value="inputs_from_paiwise_prot/ReciprocalBestHits_AmAmphi_AcAcaud.fasta,inputs_from_paiwise_prot/ReciprocalBestHits_ApApomp_AcAcaud.fasta,inputs_from_paiwise_prot/ReciprocalBestHits_ApApomp_AmAmphi.fasta,inputs_from_paiwise_prot/ReciprocalBestHits_PfPfiji_AcAcaud.fasta,inputs_from_paiwise_prot/ReciprocalBestHits_PfPfiji_AmAmphi.fasta,inputs_from_paiwise_prot/ReciprocalBestHits_PfPfiji_ApApomp.fasta" />
			<output name="log" value="pogs.output" />
            <output_collection name="output" type="list">
                <element name="locus1_sp2" value="outputs_pogs/locus1_sp2.fasta" />
                <element name="locus1_sp3" value="outputs_pogs/locus1_sp3.fasta" />
                <element name="locus2_sp2" value="outputs_pogs/locus2_sp2.fasta" />
                <element name="locus3_sp2" value="outputs_pogs/locus3_sp2.fasta" />
                <element name="locus4_sp2" value="outputs_pogs/locus4_sp2.fasta" />
                <element name="locus5_sp2" value="outputs_pogs/locus5_sp2.fasta" />
                <element name="locus6_sp2" value="outputs_pogs/locus6_sp2.fasta" />
                <element name="locus7_sp2" value="outputs_pogs/locus7_sp2.fasta" />
                <element name="locus8_sp2" value="outputs_pogs/locus8_sp2.fasta" />
                <element name="locus9_sp2" value="outputs_pogs/locus9_sp2.fasta" />
                <element name="locus10_sp2" value="outputs_pogs/locus10_sp2.fasta" />
            </output_collection>
		</test>
	</tests>

	<help>

@HELP_AUTHORS@

============
What it does
============

| This tool takes a 'data collection list' containing nucleic fasta sequence files and a 'data collection list' containing a file per pairwise with the homologous sequences (in proteic format). It searches for orthologous sequences.
| There are 2 outputs.
|

--------

======
Inputs
======


--------

=======
Outputs
=======

This tool, produces the following files :

**POGs** :

| is the general output. It gives different informations : number of locus, each locus, ...
| it gives for example, all the locus containing 2 species :
| 2_sp : [[name_of_sequence,name_of_squence],...,[name_of_sequence, name_of_sequence]]
| it's the same for locus containing 3 species, 4 species, ...
|

**POGs_locus_orthologs_unaligned** :

| is the output which contains each locus.
| one file corresponding to one locus.

the sequences of each locus are in nucleic format.

--------

===============
Working Example
===============

---------------
The input files
---------------


| 3 files with 200 nucleic sequences each : Ac.fasta Ap.fasta Pf.fasta.
| a 'data collection list' with 3 files containing the homologous sequences of each pairwise.
|

----------------
The output files
----------------

**POGs**

| Number of locus = 56
|
| NUMBER OF REMAINING LOCUS AFTER 1RST TREATMENT [INTRA LOCUS] = 55

NUMBER OF REMAINING LOCUS AFTER 2ND TREATMENT [INTER LOCUS] = 53

| 2_sp : [['&gt;Ac111_5/5_0.688_714', '&gt;Ap70_3/8_0.688_1127'], ['&gt;Ac99_4/4_0.571_7188', '&gt;Ap74_6/9_0.406_9467'], ['&gt;Ac200_7/8_0.694_1836', '&gt;Ap53_1/1_1.000_938'],
| ['&gt;Ac181_6/10_0.432_8240', '&gt;Ap103_3/10_0.420_9102'], ['&gt;Ac4_2/2_1.000_230', '&gt;Ap27_4/6_0.556_8404'], ['&gt;Ac189_9/10_0.839_7194', '&gt;Ap97_3/4_0.452_3023'],
| ['&gt;Ac145_4/5_0.538_1334', '&gt;Ap168_5/6_0.824_2007'], ['&gt;Ac178_1/1_1.000_758', '&gt;Ap202_3/3_0.905_2656'], ['&gt;Ac100_1/2_1.000_2338', '&gt;Ap77_5/8_0.405_866'],
| ['&gt;Ac86_3/5_0.780_4131', '&gt;Ap41_5/10_0.362_5218'], ['&gt;Ac140_4/4_0.886_637', '&gt;Ap62_1/3_0.667_482'], ['&gt;Ac144_1/1_1.000_4240', '&gt;Ap162_1/1_1.000_4925'],
| ['&gt;Ac34_3/8_0.548_7600', '&gt;Ap144_6/10_0.690_9671'], ['&gt;Ac187_1/7_0.618_12870', '&gt;Ap73_7/10_0.343_2424'], ['&gt;Ac120_1/1_1.000_522', '&gt;Pf74_1/1_1.000_506'],
| ['&gt;Ac108_2/10_0.395_1982', '&gt;Pf26_1/1_1.000_1717'], ['&gt;Ac88_4/4_0.833_906', '&gt;Pf102_1/1_1.000_1876'], ['&gt;Ac202_1/1_1.000_247', '&gt;Pf36_2/3_0.800_1482'],
| ['&gt;Ac121_1/1_1.000_659', '&gt;Pf7_1/1_1.000_2255'], ['&gt;Ac129_1/5_0.636_1798', '&gt;Pf100_2/4_0.625_1698'], ['&gt;Ac172_1/1_1.000_348', '&gt;Pf118_1/1_1.000_1108'],
| ['&gt;Ac66_3/4_0.462_1465', '&gt;Pf229_1/1_1.000_1541'], ['&gt;Ac47_2/7_0.412_1703', '&gt;Pf1_1/2_1.000_1890'], ['&gt;Ac171_3/3_0.926_338', '&gt;Pf4_1/1_1.000_1337'],
| ['&gt;Ac194_1/5_0.875_275', '&gt;Pf106_1/2_1.000_994'], ['&gt;Ap2_1/2_1.000_264', '&gt;Pf19_1/1_1.000_1879'], ['&gt;Ap35_1/1_1.000_2505', '&gt;Pf70_1/1_1.000_1462'],
| ['&gt;Ap116_3/4_0.600_1380', '&gt;Pf78_1/1_1.000_1409'],  ['&gt;Ap193_8/9_0.614_1707', '&gt;Pf21_1/8_0.630_1314'], ['&gt;Ap51_1/2_1.000_4292', '&gt;Pf164_1/1_1.000_1021'],
| ['&gt;Ap170_1/3_0.778_1303', '&gt;Pf87_2/4_0.700_773'], ['&gt;Ap186_6/10_0.521_4506', '&gt;Pf72_1/1_1.000_2344'],['&gt;Ap114_1/2_1.000_859', '&gt;Pf192_1/1_1.000_957'],
| ['&gt;Ap65_3/7_0.278_914', '&gt;Pf94_1/1_1.000_1135'], ['&gt;Ap164_4/5_0.560_219', '&gt;Pf163_4/4_0.556_866'], ['&gt;Ap199_3/3_0.846_958', '&gt;Pf58_1/3_0.667_1387'],
| ['&gt;Ap183_7/8_0.326_2702', '&gt;Pf166_1/2_1.000_2528'], ['&gt;Ap89_3/3_0.905_211', '&gt;Pf3_4/4_0.688_1776'], ['&gt;Ap34_1/1_1.000_2528', '&gt;Pf76_3/3_0.500_1714'],
| ['&gt;Ap16_1/3_0.714_734', '&gt;Pf139_1/1_1.000_508'], ['&gt;Ap119_9/9_0.595_3402', '&gt;Pf108_1/1_1.000_1932'], ['&gt;Ap120_5/10_0.223_8988', '&gt;Pf57_1/1_1.000_2461'],
| ['&gt;Ap43_1/3_0.778_644', '&gt;Pf2_1/1_1.000_582']]
|
| 3_sp : [['&gt;Ac112_1/2_1.000_2711', '&gt;Ap90_7/10_0.397_2604', '&gt;Pf79_1/1_1.000_4515'], ['&gt;Ac148_1/1_1.000_596', '&gt;Ap32_1/1_1.000_664', '&gt;Pf180_1/2_1.000_2336'],
| ['&gt;Ac177_1/2_1.000_1664', '&gt;Ap147_1/2_1.000_1728', '&gt;Pf178_1/1_1.000_1671'], ['&gt;Ac124_3/3_0.375_1572', '&gt;Ap177_1/3_0.667_625', '&gt;Pf115_1/1_1.000_557'],
| ['&gt;Ac53_3/4_0.375_999', '&gt;Ap40_1/1_1.000_1011', '&gt;Pf201_1/1_1.000_908'], ['&gt;Ac65_1/2_0.812_306', '&gt;Ap59_7/10_0.227_2379', '&gt;Pf32_3/3_0.818_1014'],
| ['&gt;Ac190_7/10_0.319_2573', '&gt;Ap166_7/10_0.279_1859', '&gt;Pf13_7/7_0.514_1779'], ['&gt;Ac1_1/2_1.000_6683', '&gt;Ap55_1/9_1.000_267', '&gt;Pf6_1/2_1.000_3095'],
| ['&gt;Ac91_2/2_0.696_4298', '&gt;Ap75_5/5_0.810_1434', '&gt;Pf69_1/1_1.000_1712'], ['&gt;Ac29_6/9_0.639_3877', '&gt;Ap124_4/8_0.267_1557', '&gt;Pf18_43/95_1.000_2422']]
|
|

**POGs_locus_orthologs_unaligned**

| For example the file locus1_sp2.fasta :
|
| &gt;Ac111_5/5_0.688_714
| ATCCGGAATGACCTTCGGCGGAGCCAGACACGCTGCTGACATCCGGGCAGACGACATGCACCAGTCGAGTGCCGGAGTGATCAACCTGCAGATGGGCACCAACCAGGGAGCGACCCAAAGCGGCATGTCCATGGGAGGTCGTCGGGACATCAGTT
| AAAAGGGGGCGTTTCACATTTCGTCCAGGATTCTGGAACTGTCCGGATCACAGTGCCACTATCCGTGTTTGATCAATTCAAATCGCTAACTTAAAACGGCCTGTATATAGCTACACTTCATTAACAAAACATTTAGCAATGCCTTATTCTATAACAAGCTACTG
| TATCAGCATAATTATGACTTTCCAATACTTCTTTTTAGCAGATCTTTAATTCTTATTCTTTCTTGTTCGCTGCGTACACTTTTTAACAATAACGTAACATTCTGTATTCATTGATCTATGCAGTTTTATATATTTGGAGTACTTGTTAACTTTAAATATCTGTTGAATGTTA
| CTTTTGAAATGTTGTCTCTAAATATTCGCATTAATTAACGTCGTGTTCTTCATCACAGTCAATGTTAACAGCAGCCATAGCACTTTAATTTATTTTGTTACTTTGTTTATTACGCATGTTTCTAAAATTATTCTTTCATTAAAGCTATTGTTCGTTGCACGTTGATAAGT

ATTGTTGTTGCGTTTCGTGATTCTATACATAATATATTCAAAACAATTAAAAA

| &gt;Ap70_3/8_0.688_1127
| GCAGGCCGGACCAACAAGGGCGCTAGCCAATCCGGAATGACCTTCGGCGGAGCCAGACACGCTGCTGACATCCGGGCAGACGACATGCACCAGTCGAGTGCCGGAGTGATCAACCTACAGATGGGCACCAACCAGGGGGCGTCCCAAAGCGGCA
| TGTCCATGGGAGGCCGTCGGGACATCAGTTAAAAGGGGGCGTTTCACATTTCGTGCCAGCGTTCTGGAACTGTCCGGATCACAGTGCCACCATCCGAGTGTTTGGTCAATTCAAATCGCTAACTTAAAACGGCCTGTATATAGCTACATTTCATTAACAAA
| ACATTTAGCGATGCCTTGTTCTATAACAAATTATTGTATCAGCATAATTATTACTTTCCAGTACTTCTTTATAGCAGATCTTTAATTATTGTTCTTTCTTGTTCGCTGCGTACTTTTTAAAAAGAATACAACATTCTGTATTCATTGATCTATGCAGTTTTATATATTTGGA

GTACTTGTTAACTTTAAATATATGTTAAATGTTACTTTTGAAATGTTGTCTCTAAATATTCGCATTAATTAACGTCGTGCTCTTCATCACAGTCAAAGTTAACATTTAACATATATTTAAAGTTAACAAGTACTCCAAATATATAAAACTGCATAGATCAATGAATACAGA
ATGTTGTATTCTTTTTAAAAAGTACGCAGCGAACAAGAAAGAACAATAATTAAAGATCTGCTATAAAGAAGTACTGGAAAGTAATAATTATGCTGATACAATAATTTGTTATAGAACAAGGCATCGCTAAATGTTTTGTTAATGAAATGTAGCTATATACAGGCCGTTT
TAAGTTAGCGATTTGAATTGACCAAACACTCGGATGGTGGCACTGTGATCCGGACAGTTCCAGAACGCTGGCACGAAATGTGAAACGCCCCCTTTTAACTGATGTCCCGACGGCCTCCCATGGACATGCCGCTTTGGGACGCCCCCTGGTTGGTGCCCA
TCTGTAGGTTGATCACTCCGGCACTCGACTGGTGCATGTCGTCTGCCCGGATGTCAGCAGCGTGTCTGGCTCCGCCGAAGGTCATTCCGGATTGGCTAGCGCCCTTGTTGGATCCAGCTTGCAGACCGATACGGCCTGGCC

|Â 
| An other example, the file locus_3_sp_5.fasta
|

&gt;Ac53_3/4_0.375_999
CCGATCTTGTCTGGTGTTTTGCTGCCCCCTAGCGAGTGACGACAAACTCGTTGGTACCTTGCTTAGCGCGATAGAAGGGTTGAACATGTTGGCTGCTGGGCTAAGAACTCTAAAAAGCCTTGCCCCTCGGGGTTGCGTAGCGTGGTCGTGTACTTCGGT
GCATGCCAAGCATACCCTACCAGACTTACCATATGATTACAATGCCCTGGAGCCACACATCAGTGCTGAAATCATGCTGCTGCATCACACCAAGCATCACCAGACGTATGTCAACAACCTGAATGTTGCAGAGGAGAAGTTTCATGAGGCTACAGAGAAA
GGTGATGTAACCACAGCAGTATCACTGATGCCAGCCCTAAGATTTAATGGTGGTGGACACATCAACCATACTATATTTTGGAAGAACATGTCACCAAATGGTGGTGGAGAGCCATCTGGCGAACTGATGGAGGCCATCAAACGTGACTTTGGCTCATTTGAA
AACATGAAGAACATGTTGAGTACATCAACCACTGCAGTGCAAGGCTCTGGCTGGGGATGGCTTGGGTACAATAAAAAGATGAAGAAACTAGAAATTGCCACCTGTGCCAACCAAGATCCATTAGAGGGCACTACAGGTCTCGTCCCGTTGTTTGGCATAG
ATGTCTGGGAACATGCCTATTACTTGCAGTACAAGAATGTTCGTCCAGACTATGTAAAGGCTATTTGGAATGTGGCCAACTGGGATGACATCATGGAACGTTACAACAATGCCAGAAAATAAACTGTTAAACAAATAATTAATATATTAATGTGTTGCAATTTTTG
TCAATTGGTACATACACAATTTTGTTCATAAAGAAAATTGTGATTACTTTCTGGCAACTAGTTCCCAGTGAATACAGCAATTGTTCTGCCAAGGATGCATTTGGATTGAGAAGGCACCCAGAATGGGTTATCCGTGAATGTCTATTGGAATGTGGCACCATACG
ATGTTTACTGTATTAGTTACAATTAAAA

| &gt;Ap40_1/1_1.000_1011
| CTGATGTGTGGCCCCCTAGCGAGTGAAGACAAACTCGATAGCACCCAGACAGTTCTGTTGGTTAGATAAAAGGGAGAAACATGCTGGCTGCTGGGCTAAGAACTCTAAAAAGCCTTGCTCCTCGTGGTGGTCTAGCTTGGTCTTGTACCTCGGTACATGC
| CAAACACACACTGCCAGACTTGCCGTATGATTATAATGCTCTGGAGCCACACATCAGTGCTGAAATCATGTTGCTGCATCACACAAAACATCACCAGACGTATGTGAACAACCTGAATATTGCAGAGGAGAAGTTTCATGAGGCTACCGAGAAAGGCGATG
| TGACCACAGCAGTATCACTGATGCCAGCCCTAAGATTTAATGGTGGTGGACATATCAACCATACTATATTTTGGAAGAACATGTCACCAAATGGTGGTGGAGAACCATCTGGCGAACTGATGGAGGCCATCAAACGTGACTTTGGTTCATTTGAAAACATGA
| AGAACATGCTGAGTACAGCAACCACTGCAGTACAAGGCTCTGGCTGGGGATGGCTTGGGTACAATAAAAAGATGAAGAAACTAGAAATTGCCACCTGTGCCAACCAAGATCCATTAGAGGGCACTACAGGTCTTGTCCCACTGTTTGGTATCGATGTCTG
| GGAACATGCCTATTATTTACAGTACAAGAATGTTCGTCCAGACTATGTAAAGGCTATTTGGAATGTGGCTAACTGGGATGATATCATGGAGCGTTACAACAATGCCAGAAAATAAACTTAAATACATCATTATTTAGTTAATGTGCGACTTTTGTTTGTTAATCAGT
| TCACACACCATTCTATTCACAAAGAAAATGGTGTATTTGCTTTCTGTTCAACTGGTTCCCGGTGAATACAGCAGTTGTTCTGCCAAGGATGTATTTGGATTGAGAAGGCACCAAGAATGGGCTGTCACTGAATGTCAATTGGAATGTAGCCTCAATGTTTACT

GTATTACCTACAATTAAAATGATTATGATATAACCAAG

| &gt;Pf201_1/1_1.000_908
| CTTCTGGAACGATGTTGGCTGGGTATAGAACTTTGGCGAGGGTTATCCCACGTGGTGTCAGCTCCGCTTGGGCAAGTACAATAGTACATAACAAGCACACCTTGCCAGATTTACCATATGATTATAATGCCTTGGAACCACACATCAGTGCTGAAATAATGC

TCCTTCATCATACAAAGCATCACCAGACATATGTGAACAATCTGAATGTAGCTGAAGAAAAGTTTCATGAAGCCACGGAGAAAGGTGATGTCACTACAGCTGTGTCGCTAATGCCAGCACTAAGATTTAATGGCGGAGGACACATCAATCACACCATTTTCT
GGAAGAACATGTCTCCTAATGGCGGAGGAGAGCCTTCTGGCGAGTTGATGGAAGCCATTAAACGTGATTTTGGTTCATTTGAGAATATGAAAAACATGTTAAGTACAGCTACAACAGCTGTCCAAGGATCTGGCTGGGGATGGCTTGGTTATAACAAAAAG
ATGAAAAAGCTCGAGATAGCCACTTGTGCCAACCAGGATCCACTGGAAGGAACAACAGGATTAATTCCACTGTTTGGTATTGACGTCTGGGAGCATGCTTACTATCTGCAATATAAAAATGTACGTCCAGATTATGTTAAAGCTATCTGGAATGTGGCCAACT
GGGATGATATTACAGAGCGCTACAACAATGCGAAGAAATAGATTTGCTGGGACATATGAATAGTGCTTGGCAGAGCCTAATGTTGTGTTTATTTCTGTGTTTCTTATCAATCAGTTGATGTATTAGCCCGGTGTATTGACATGAAGAATTGGACAATGATTTCAAA
TACATTTGAACAATAAATGTATCATGATCAAGCATTATTTTGTTAGTTGTCTCCTCCACTGAGAAGACCAAGTTTAATAAACAACAAACACAGA

---------------------------------------------------

Changelog
---------

**Version 2.0 - 18/04/2017**

 - NEW: Replace the zip between tools by Dataset Collection


**Version 1.0 - 13/04/2017**

 - TEST: Add funtional test with planemo

 - IMPROVEMENT: Use conda dependencies for python


	</help>

	<expand macro="citations" />

</tool>
